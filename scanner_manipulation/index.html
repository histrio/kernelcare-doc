<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Scanner manipulation | Documentation</title>
    <meta name="description" content="KernelСare documentation">
    <script src="https://js.hs-scripts.com/5408110.js"></script>
  <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.2649172e.css" as="style"><link rel="preload" href="/assets/js/app.9e1736f5.js" as="script"><link rel="preload" href="/assets/js/41.4cb3e856.js" as="script"><link rel="prefetch" href="/assets/js/10.f0645d4c.js"><link rel="prefetch" href="/assets/js/11.d568b404.js"><link rel="prefetch" href="/assets/js/12.f00e0077.js"><link rel="prefetch" href="/assets/js/13.07ee3a42.js"><link rel="prefetch" href="/assets/js/14.c345e0aa.js"><link rel="prefetch" href="/assets/js/15.16490412.js"><link rel="prefetch" href="/assets/js/16.b53abcbd.js"><link rel="prefetch" href="/assets/js/17.d1883fab.js"><link rel="prefetch" href="/assets/js/18.fc251982.js"><link rel="prefetch" href="/assets/js/19.51235d3d.js"><link rel="prefetch" href="/assets/js/20.b7d85685.js"><link rel="prefetch" href="/assets/js/21.5f72d37d.js"><link rel="prefetch" href="/assets/js/22.1be743d5.js"><link rel="prefetch" href="/assets/js/23.8bb11991.js"><link rel="prefetch" href="/assets/js/24.508f1e94.js"><link rel="prefetch" href="/assets/js/25.c9414e19.js"><link rel="prefetch" href="/assets/js/26.8d61be00.js"><link rel="prefetch" href="/assets/js/27.55a1c65e.js"><link rel="prefetch" href="/assets/js/28.a4a1a8df.js"><link rel="prefetch" href="/assets/js/29.7b50aa8c.js"><link rel="prefetch" href="/assets/js/3.af86d45c.js"><link rel="prefetch" href="/assets/js/30.773fcd3c.js"><link rel="prefetch" href="/assets/js/31.b038385b.js"><link rel="prefetch" href="/assets/js/32.feb4eac9.js"><link rel="prefetch" href="/assets/js/33.a33eb676.js"><link rel="prefetch" href="/assets/js/34.cfa00764.js"><link rel="prefetch" href="/assets/js/35.34f9df88.js"><link rel="prefetch" href="/assets/js/36.6390011a.js"><link rel="prefetch" href="/assets/js/37.15aeb46f.js"><link rel="prefetch" href="/assets/js/38.fd666c96.js"><link rel="prefetch" href="/assets/js/39.507341fc.js"><link rel="prefetch" href="/assets/js/4.1c60dddb.js"><link rel="prefetch" href="/assets/js/40.968b3410.js"><link rel="prefetch" href="/assets/js/42.16c47306.js"><link rel="prefetch" href="/assets/js/43.46f3eb7a.js"><link rel="prefetch" href="/assets/js/44.f983eb4c.js"><link rel="prefetch" href="/assets/js/45.b4345e0b.js"><link rel="prefetch" href="/assets/js/46.2d3397f6.js"><link rel="prefetch" href="/assets/js/47.5feb156c.js"><link rel="prefetch" href="/assets/js/48.97840c08.js"><link rel="prefetch" href="/assets/js/5.a7969755.js"><link rel="prefetch" href="/assets/js/6.11dbc1f2.js"><link rel="prefetch" href="/assets/js/7.81620944.js"><link rel="prefetch" href="/assets/js/8.2546602c.js"><link rel="prefetch" href="/assets/js/9.0b3c3a74.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.ddfd2311.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2649172e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="Documentation" class="logo"> <span class="site-name site-name--documentation can-hide">Documentation</span></a> <form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <div class="links" style="max-width:nullpx;"><a href="https://www.kernelcare.com/free-trial/" target="_blank" class="btn">
      Try Free
    </a> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><span class="title">Language:</span> <a class="dropdown-title"><span class="text">En</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/scanner_manipulation/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/jp/" class="nav-link">日本語</a></li></ul></div></div></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><span class="title">Language:</span> <a class="dropdown-title"><span class="text">En</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/scanner_manipulation/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/jp/" class="nav-link">日本語</a></li></ul></div></div></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><div class="sidebar-heading open"><span>Content</span> <!----></div> <ul class="sidebar-group-items"><li><a href="/installation/" class="sidebar-link">Installation of KernelCare</a></li><li><a href="/settings/" class="sidebar-link">Basic Management</a></li><li><a href="/command_line/" class="sidebar-link">Command Line Tools</a></li><li><a href="/how_to's/" class="sidebar-link">How-To's</a></li><li><a href="/config_options/" class="sidebar-link">Config Options</a></li><li><a href="/disabling_some_patches/" class="sidebar-link">Disabling Some Patches</a></li><li><a href="/delayed_feed/" class="sidebar-link">Delayed Feed</a></li><li><a href="/extra_patchset/" class="sidebar-link">Extra Patchset</a></li><li><a href="/sticky_patches/" class="sidebar-link">Sticky Patches</a></li><li><a href="/scanner_manipulation/" class="active sidebar-link">Scanner manipulation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/scanner_manipulation/#issue-description" class="sidebar-link">Issue description</a></li><li class="sidebar-sub-header"><a href="/scanner_manipulation/#how-does-it-work" class="sidebar-link">How does it work</a></li><li class="sidebar-sub-header"><a href="/scanner_manipulation/#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/scanner_manipulation/#how-to-use" class="sidebar-link">How to use</a></li></ul></li><li><a href="/nagios_plugin/" class="sidebar-link">Nagios Plugin</a></li><li><a href="/zabbix_template/" class="sidebar-link">Zabbix Template</a></li><li><a href="/upgrade/" class="sidebar-link">Upgrade</a></li><li><a href="/uninstall/" class="sidebar-link">Uninstall KernelCare</a></li><li><a href="/technology/" class="sidebar-link">Technology</a></li><li><a href="/AWS_deployment_guide/" class="sidebar-link">KernelCare on AWS – Deployment User Guide</a></li><li><a href="/reseller_partner_ui/" class="sidebar-link">Reseller Partner UI</a></li><li><a href="/kernelcare_enterprise/" class="sidebar-link">KernelCare.ePortal</a></li><li><a href="/kcare-nexpose/" class="sidebar-link">Kcare-nexpose</a></li><li><a href="/kernelcare_whmcs_plugin/" class="sidebar-link">KernelCare WHMCS Plugin</a></li><li><a href="/proxy_settings/" class="sidebar-link">Firewall and Proxy Settings</a></li><li><a href="/eol_ubuntu_lts_kernels_support/" class="sidebar-link">EOL Ubuntu LTS kernels support</a></li></ul></div></li></ul> </div> <div class="page"> <div class="breadcrumb-wrapper page-breadcrumb" data-v-5e0e0acf><span class="breadcrumb-title" data-v-5e0e0acf>Documentation:</span> <a href="/scanner_manipulation/" class="breadcrumb router-link-exact-active router-link-active" data-v-5e0e0acf>
    Scanner manipulation
  </a></div> <div class="page-nav-wrapper"><div class="page-nav"><a href="/sticky_patches/" class="nav-arrow left"></a> <a href="/nagios_plugin/" class="nav-arrow right"></a></div></div> <div class="content"><h1 id="scanner-manipulation"><a href="#scanner-manipulation" aria-hidden="true" class="header-anchor">#</a> Scanner manipulation</h1> <h2 id="issue-description"><a href="#issue-description" aria-hidden="true" class="header-anchor">#</a> Issue description</h2> <p>Commonly used security scanners can still see CVEs even if they are patched by KernelCare. It turns out that all their decisions about CVE are based on:</p> <ul><li>currently installed (or not) kernel packages</li> <li>uname information</li></ul> <h2 id="how-does-it-work"><a href="#how-does-it-work" aria-hidden="true" class="header-anchor">#</a> How does it work</h2> <p>To calm them down, we can manipulate with that information and the common part for DEB and RPM distributions relying on <code>uname -r</code> output.</p> <p>Since scanners on RPM distributions relies on <code>rpm -q</code> output, we can override some functions there via <code>LD_PRELOAD</code> and force the script to output versions we need.</p> <p>To deal with it, we will reload <code>showQueryPackage</code> to patch version information on the fly. It will change the information showing in rpm query results like this.</p> <div class="language- extra-class"><pre class="language-text"><code>[centos@ip-172-31-6-166 ~]$ rpm -q kernel-headers
kernel-headers-3.10.0-693.17.1.el7.x86_64
[centos@ip-172-31-6-166 ~]$ LD_PRELOAD=/usr/libexec/kcare/kpatch_package.so rpm -q
kernel-headers-3.10.0-957.21.3.el7.x86_64
</code></pre></div><p>The reloaded functions rely on <code>kcarectl --uname</code> and replace the actual kernel version with our “effective version”.
That behavior is enabled only for one user and will not interfere with others. That user should be used to run a credentialed scan over SSH.</p> <h2 id="installation"><a href="#installation" aria-hidden="true" class="header-anchor">#</a> Installation</h2> <p>All you need to do on target systems is to install/update KernelCare agent with the provided package.</p> <div class="language- extra-class"><pre class="language-text"><code>KCARE_SCANNER_USER=username yum -y localinstall ./kernelcare-package.rpm
</code></pre></div><p>Or update an existing package:</p> <div class="language- extra-class"><pre class="language-text"><code>KCARE_SCANNER_USER=username yum update kernelcare
</code></pre></div><p>Or install:</p> <div class="language- extra-class"><pre class="language-text"><code>curl -s -L https://kernelcare.com/installer | KCARE_SCANNER_USER=username bash
</code></pre></div><p>Where <code>username</code> is the user which will be used to run scanners on the server.
After applying KernelCare patches (<code>kcarectl --update</code>) you will see rpm query result according to a kernel that the patches are provided.</p> <div class="tip custom-block"><p class="custom-block-title">Note</p> <p>To see results, you should re-login to the server with <code>KCARE_SCANNER_USER</code> defined above.</p></div> <h2 id="how-to-use"><a href="#how-to-use" aria-hidden="true" class="header-anchor">#</a> How to use</h2> <p>It’s rather simple. New scan results after installing a package and applying a patchset should not show any kernel CVEs that are handled by KernelCare.</p> <p>For example, Nessus for an old kernel shows a bunch of detected CVEs</p> <p><img src="/images/scanner-manipulation-before.png" alt></p> <p>After patches were applied, there are no kernel-related CVEs</p> <p><img src="/images/scanner-manipulation-after.png" alt></p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/cloudlinux/kernelcare-doc/edit/dev/docs/scanner_manipulation/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="back-to-top" data-v-5366e0dd><a href="/scanner_manipulation/#app" class="nav-arrow top back-to-top__link" data-v-5366e0dd></a></div> </div> <div class="footer" data-v-20b89de8><div data-v-20b89de8><a href="https://cloudlinux.com" data-v-20b89de8><img src="/assets/img/we-are-cloudlinux.783ed390.svg" alt="We are Cloudlinux" data-v-20b89de8></a></div> <div class="footer-company-title" data-v-20b89de8>2019. CloudLinux Inc</div> <div data-v-20b89de8><div data-v-20b89de8><a href="https://www.kernelcare.com/install-kernelcare/" target="_blank" data-v-20b89de8>How to</a></div><div data-v-20b89de8><a href="https://www.kernelcare.com/faq/" target="_blank" data-v-20b89de8>Sales and Technical FAQs</a></div><div data-v-20b89de8><a href="https://cloudlinux.zendesk.com/hc/en-us/requests/new" target="_blank" data-v-20b89de8>Contact support</a></div><div data-v-20b89de8><a href="https://www.kernelcare.com/blog/" target="_blank" data-v-20b89de8>Blog</a></div></div> <div class="social" data-v-20b89de8><span class="footer-social-text" data-v-20b89de8></span> <a href="https://www.facebook.com/kernelcare/" target="_blank" data-v-20b89de8><img src="/fb.png" class="footer-social-logo" data-v-20b89de8></a><a href="https://twitter.com/kernelcare/" target="_blank" data-v-20b89de8><img src="/tw.png" class="footer-social-logo" data-v-20b89de8></a><a href="https://linkedin.com/company/cloudlinux" target="_blank" data-v-20b89de8><img src="/in.png" class="footer-social-logo" data-v-20b89de8></a><a href="https://www.youtube.com/channel/UCZ3YMHWnMP7TaxlXVay5-aw" target="_blank" data-v-20b89de8><img src="/ytube.png" class="footer-social-logo" data-v-20b89de8></a></div></div> <!----></div></div>
    <script src="/assets/js/app.9e1736f5.js" defer></script><script src="/assets/js/41.4cb3e856.js" defer></script>
  </body>
</html>
